{
  "info": {
    "_postman_id": "3c7c2f30-7f2f-4fe9-8de1-7c3e9a4c3b1f",
    "name": "UBRO Backend API (v1)",
    "description": "Коллекция сгенерирована из кодовой базы (/api/v1).\n\nАвторизация: большинство эндпоинтов требуют JWT в заголовке Authorization (Bearer). Токен получается через /auth/verify (OTP).\n\nБазовый URL: {{baseUrl}}",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8000"
    },
    {
      "key": "accessToken",
      "value": ""
    },
    {
      "key": "refreshToken",
      "value": ""
    },
    {
      "key": "phone",
      "value": "+79990000000"
    },
    {
      "key": "otpCode",
      "value": "000000"
    },
    {
      "key": "userId",
      "value": "1"
    },
    {
      "key": "rideId",
      "value": "1"
    },
    {
      "key": "driverProfileId",
      "value": "1"
    },
    {
      "key": "driverId",
      "value": "1"
    },
    {
      "key": "messageId",
      "value": "1"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "General",
      "description": "Служебные эндпоинты для базовой проверки доступности API.",
      "item": [
        {
          "name": "GET /health",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/health",
            "description": "Проверка работоспособности сервиса. Публичный эндпоинт."
          }
        }
      ]
    },
    {
      "name": "Auth",
      "description": "Аутентификация по телефону через OTP (одноразовый код) и выпуск JWT токенов.\n\nОбычно поток такой: register/login (регистрация/вход) → verify (получить access_token/refresh_token) → использовать Bearer токен в остальных запросах → refresh для обновления токенов.",
      "item": [
        {
          "name": "POST /auth/register",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"role_code\": \"user\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/auth/register",
            "description": "Регистрация пользователя. Публичный эндпоинт.\n\nТело запроса: { phone, role_code: 'user'|'driver' }.\n\nВозвращает PhoneVerificationSchema (запись OTP)."
          }
        },
        {
          "name": "POST /auth/login",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/auth/login",
            "description": "Логин по телефону (OTP поток). Публичный эндпоинт.\n\nВозвращает PhoneVerificationSchema (запись OTP)."
          }
        },
        {
          "name": "POST /auth/verify (OTP -> tokens)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code >= 200 && pm.response.code < 300) {",
                  "  const data = pm.response.json();",
                  "  if (data && data.access_token) pm.collectionVariables.set('accessToken', data.access_token);",
                  "  if (data && data.refresh_token) pm.collectionVariables.set('refreshToken', data.refresh_token);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"code\": \"{{otpCode}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/auth/verify",
            "description": "Подтверждение OTP и получение JWT токенов. Публичный эндпоинт.\n\nВажно: реализация ищет OTP по телефону, поэтому phone обязателен.\n\nВозвращает: { access_token, refresh_token }. Этот запрос сохраняет токены в переменные коллекции."
          }
        },
        {
          "name": "POST /auth/refresh",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code >= 200 && pm.response.code < 300) {",
                  "  const data = pm.response.json();",
                  "  if (data && data.access_token) pm.collectionVariables.set('accessToken', data.access_token);",
                  "  if (data && data.refresh_token) pm.collectionVariables.set('refreshToken', data.refresh_token);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh_token\": \"{{refreshToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/auth/refresh",
            "description": "Обновление токенов. Публичный эндпоинт.\n\nВозвращает: { access_token, refresh_token }. Этот запрос обновляет переменные коллекции."
          }
        }
      ]
    },
    {
      "name": "Users",
      "description": "Эндпоинты для работы с пользователями: получение своего профиля, список/создание/редактирование/удаление (часть операций ограничена ролью admin).",
      "item": [
        {
          "name": "GET /users/me",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/users/me",
            "description": "Требуется заголовок Authorization: Bearer <JWT>.\nРазрешённые роли: user, driver, admin.\nТелефон должен быть подтверждён (последний PhoneVerification.status == 'confirmed')."
          }
        },
        {
          "name": "GET /users (paginated)",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/users?page=1&page_size=10",
            "description": "Список пользователей с пагинацией. В роутере не задана явная зависимость авторизации."
          }
        },
        {
          "name": "POST /users",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"+79990000000\",\n  \"is_active\": true,\n  \"role_id\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/users",
            "description": "Требуется роль: admin (телефон подтверждён)."
          }
        },
        {
          "name": "GET /users/{id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/users/{{userId}}",
            "description": "Получение пользователя по id. В роутере не задана явная зависимость авторизации."
          }
        },
        {
          "name": "PUT /users/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": {{userId}},\n  \"phone\": \"+79990000000\",\n  \"is_active\": true,\n  \"role_id\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/users/{{userId}}",
            "description": "Требуется роль: admin (телефон подтверждён)."
          }
        },
        {
          "name": "DELETE /users/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/users/{{userId}}",
            "description": "Требуется роль: admin (телефон подтверждён)."
          }
        }
      ]
    },
    {
      "name": "Rides",
      "description": "Эндпоинты для управления поездками (заказами такси): создание заказа, просмотр, изменение статуса со стороны клиента/водителя и завершение поездки.\n\nСтатусы поездки: requested, accepted, started, completed, canceled.\n\nТиповые переходы:\n- requested → accepted (водитель принимает: PUT /rides/{id}/accept)\n- accepted → started (водитель начинает поездку: PUT /rides/{id}/driver)\n- started → completed (водитель завершает: PUT /rides/{id}/finish)\n- requested/accepted/started → canceled (отмена: PUT /rides/{id}/client или PUT /rides/{id}/driver — зависит от роли и логики)\n\nПримечания:\n- Создание (POST /rides) всегда создаёт заказ от имени текущего JWT пользователя (client_id берётся из токена).\n- Для /client требуется владение заказом (Ride.client_id == JWT user_id).\n- Для /driver и /finish требуется привязка driver_profile к текущему пользователю (require_driver_profile).\n- PUT/DELETE /rides/{id} ограничены admin.",
      "item": [
        {
          "name": "GET /rides (paginated)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/rides?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /rides (create)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"pickup_address\": \"Москва, ул. Ленина 1\",\n  \"pickup_lat\": 55.751244,\n  \"pickup_lng\": 37.618423,\n  \"dropoff_address\": \"Москва, ул. Пушкина 10\",\n  \"dropoff_lat\": 55.760000,\n  \"dropoff_lng\": 37.620000,\n  \"distance_meters\": 12000,\n  \"duration_seconds\": 1500,\n  \"commission_id\": 1,\n  \"tariff_plan_id\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/rides",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён.\nНа сервере client_id берётся из JWT user_id."
          }
        },
        {
          "name": "GET /rides/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /rides/{id} (admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": {{rideId}},\n  \"client_id\": 1,\n  \"status\": \"requested\",\n  \"pickup_lat\": 55.751244,\n  \"pickup_lng\": 37.618423,\n  \"dropoff_lat\": 55.760000,\n  \"dropoff_lng\": 37.620000,\n  \"distance_meters\": 12000,\n  \"tariff_plan_id\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /rides/{id} (admin)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /rides/{id}/client (owner)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"canceled\",\n  \"status_reason\": \"Changed my mind\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}/client",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён.\nТакже требуется проверка владельца: Ride.client_id должен совпадать с JWT user_id."
          }
        },
        {
          "name": "PUT /rides/{id}/driver (driver owns driver_profile)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"started\",\n  \"status_reason\": \"Водитель начал поездку\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}/driver",
            "description": "Требуется роль: driver/admin, телефон подтверждён.\nТакже требуется require_driver_profile(Ride): ride.driver_profile.user_id должен совпадать с JWT user_id."
          }
        },
        {
          "name": "PUT /rides/{id}/accept",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"accepted\",\n  \"status_reason\": \"Accepted\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}/accept",
            "description": "Требуется роль: driver/admin, телефон подтверждён.\nСервер подставляет driver_profile_id из JWT пользователя через get_current_driver_profile_id.\nВозможные ошибки: 404 поездка не найдена, 409 поездка уже принята."
          }
        },
        {
          "name": "PUT /rides/{id}/finish",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"completed\",\n  \"actual_fare\": 500\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/rides/{{rideId}}/finish",
            "description": "Требуется роль: driver/admin, телефон подтверждён.\nТакже требуется require_driver_profile(Ride).\nСервер может пометить аномалию, если expected_fare != actual_fare."
          }
        }
      ]
    },
    {
      "name": "Roles",
      "description": "Справочник ролей (например: user/driver/admin). Используется для управления доступом к эндпоинтам.",
      "item": [
        {
          "name": "GET /roles",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/roles?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /roles",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"operator\",\n  \"name\": \"Operator\",\n  \"description\": \"Support operator\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/roles",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /roles/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/roles/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /roles/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"operator\",\n  \"name\": \"Operator\",\n  \"description\": \"Updated description\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/roles/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /roles/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/roles/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        }
      ]
    },
    {
      "name": "DriverProfiles",
      "description": "Профиль водителя: личные данные, водительские реквизиты, допуски, а также модерация/подтверждение профиля администратором.",
      "item": [
        {
          "name": "GET /driver-profiles",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-profiles?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /driver-profiles",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user_id\": {{userId}},\n  \"first_name\": \"Ivan\",\n  \"last_name\": \"Ivanov\",\n  \"license_number\": \"AB123456\",\n  \"classes_allowed\": {\"economy\": true}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-profiles",
            "description": "Требуется роль: driver/admin, телефон подтверждён.\nТакже требуется require_driver_verification: user.role должен быть 'driver' и user.driver_profile.approved должен быть true."
          }
        },
        {
          "name": "GET /driver-profiles/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-profiles/{{driverProfileId}}",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /driver-profiles/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"first_name\": \"Ivan\",\n  \"last_name\": \"Ivanov\",\n  \"display_name\": \"Ivan\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-profiles/{{driverProfileId}}",
            "description": "Требуется роль: driver/admin, телефон подтверждён.\nТребуется верифицированный водитель и проверка владельца: DriverProfile.user_id == JWT user_id."
          }
        },
        {
          "name": "DELETE /driver-profiles/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-profiles/{{driverProfileId}}",
            "description": "Требуется роль: driver/admin, телефон подтверждён.\nТребуется верифицированный водитель и проверка владельца."
          }
        },
        {
          "name": "PUT /driver-profiles/{id}/approve",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"approved\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-profiles/{{driverProfileId}}/approve",
            "description": "Требуется роль: admin, телефон подтверждён.\nСервер устанавливает approved_by из JWT user_id."
          }
        }
      ]
    },
    {
      "name": "DriverDocuments",
      "description": "Документы водителя (сканы/файлы) и их статус проверки. Часть операций требует, чтобы водитель был верифицирован (approved).",
      "item": [
        {
          "name": "GET /driver-documents",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-documents?page=1&page_size=10",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /driver-documents",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driver_profile_id\": {{driverProfileId}},\n  \"doc_type\": \"license\",\n  \"file_url\": \"https://example.com/file.pdf\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-documents",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован."
          }
        },
        {
          "name": "GET /driver-documents/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-documents/1",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован, а также require_driver_profile(DriverDocument)."
          }
        },
        {
          "name": "PUT /driver-documents/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"approved\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-documents/1",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован, а также require_driver_profile(DriverDocument)."
          }
        },
        {
          "name": "DELETE /driver-documents/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-documents/1",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован, а также require_driver_profile(DriverDocument)."
          }
        }
      ]
    },
    {
      "name": "DriverLocations",
      "description": "Координаты и онлайн-статус водителя (CRUD), используются для трекинга и/или матчинг-логики.",
      "item": [
        {
          "name": "GET /driver-locations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-locations?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /driver-locations",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driver_profile_id\": {{driverProfileId}},\n  \"latitude\": 55.751244,\n  \"longitude\": 37.618423,\n  \"accuracy_m\": 20,\n  \"provider\": \"gps\",\n  \"is_online\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-locations",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован."
          }
        },
        {
          "name": "GET /driver-locations/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-locations/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /driver-locations/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"latitude\": 55.752000,\n  \"longitude\": 37.619000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-locations/1",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован, а также require_driver_profile(DriverLocation)."
          }
        },
        {
          "name": "DELETE /driver-locations/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-locations/1",
            "description": "Требуется роль: driver/admin, телефон подтверждён, водитель верифицирован, а также require_driver_profile(DriverLocation)."
          }
        }
      ]
    },
    {
      "name": "PhoneVerifications (admin)",
      "description": "Административный доступ к записям подтверждения телефона (OTP): просмотр, создание, изменение статуса и удаление записей.",
      "item": [
        {
          "name": "GET /phone-verifications",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/phone-verifications?page=1&page_size=10",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /phone-verifications/count",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/phone-verifications/count",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /phone-verifications/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/phone-verifications/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /phone-verifications",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user_id\": {{userId}},\n  \"phone\": \"{{phone}}\",\n  \"code\": \"123456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/phone-verifications",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /phone-verifications/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"confirmed\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/phone-verifications/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /phone-verifications/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/phone-verifications/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        }
      ]
    },
    {
      "name": "Commissions",
      "description": "Комиссии сервиса: просмотр/управление схемами комиссий, которые могут применяться в расчётах поездки.",
      "item": [
        {
          "name": "GET /commissions/count",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/commissions/count",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /commissions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/commissions?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /commissions",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Standard\",\n  \"percentage\": 10,\n  \"currency\": \"RUB\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/commissions",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /commissions/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/commissions/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /commissions/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"percentage\": 12\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/commissions/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /commissions/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/commissions/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        }
      ]
    },
    {
      "name": "ChatMessages (CRUD)",
      "description": "CRUD доступ к сообщениям чата (как сущности в БД): список, создание, редактирование и удаление. Дополнительно применяется проверка владельца сообщения для update/delete.",
      "item": [
        {
          "name": "GET /chat-messages/count",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat-messages/count",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /chat-messages",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat-messages?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /chat-messages",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ride_id\": {{rideId}},\n  \"sender_id\": {{userId}},\n  \"receiver_id\": 2,\n  \"text\": \"Hello\",\n  \"message_type\": \"text\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/chat-messages",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /chat-messages/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat-messages/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /chat-messages/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"Edited\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/chat-messages/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён.\nТакже требуется проверка владельца: ChatMessage.sender_id == JWT user_id."
          }
        },
        {
          "name": "DELETE /chat-messages/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat-messages/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён.\nТакже требуется проверка владельца: ChatMessage.sender_id == JWT user_id."
          }
        }
      ]
    },
    {
      "name": "Transactions",
      "description": "Транзакции (пополнения/выводы) по балансу пользователя. Часть операций ограничена admin.",
      "item": [
        {
          "name": "GET /transactions",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/transactions?page=1&page_size=10",
            "description": "В роутере не задана явная зависимость авторизации."
          }
        },
        {
          "name": "POST /transactions (admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user_id\": {{userId}},\n  \"is_withdraw\": false,\n  \"amount\": 1000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/transactions",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /transactions/{id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/transactions/1",
            "description": "В роутере не задана явная зависимость авторизации."
          }
        },
        {
          "name": "PUT /transactions/{id} (admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 1500\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/transactions/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /transactions/{id} (admin)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/transactions/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        }
      ]
    },
    {
      "name": "TariffPlan",
      "description": "Тарифные планы и правила расчёта стоимости: базовая стоимость, ставка за метр, множитель, период действия и % комиссии.",
      "item": [
        {
          "name": "GET /tariff_plans",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/tariff_plans?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /tariff_plans (admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Economy\",\n  \"base_fare\": 150,\n  \"rate_per_meter\": 0.02,\n  \"multiplier\": 1.0\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/tariff_plans",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /tariff_plans/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/tariff_plans/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /tariff_plans/{id} (admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Economy\",\n  \"base_fare\": 200,\n  \"rate_per_meter\": 0.02,\n  \"multiplier\": 1.0\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/tariff_plans/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /tariff_plans/{id} (admin)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/tariff_plans/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        }
      ]
    },
    {
      "name": "Documents (PDF)",
      "description": "Генерация PDF документов (квитанции/отчёты/выписки) и проверка готовности PDF-генератора. Ответы чаще всего в формате application/pdf.",
      "item": [
        {
          "name": "GET /documents/ride/{ride_id}/receipt",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/pdf"
              }
            ],
            "url": "{{baseUrl}}/api/v1/documents/ride/{{rideId}}/receipt?download=false",
            "description": "Возвращает application/pdf. Параметры query: download=true|false для управления заголовком Content-Disposition."
          }
        },
        {
          "name": "GET /documents/driver/{driver_id}/report",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/pdf"
              }
            ],
            "url": "{{baseUrl}}/api/v1/documents/driver/{{driverId}}/report?period_days=30&download=false",
            "description": "Возвращает application/pdf. Параметры query: period_days (1..365), download."
          }
        },
        {
          "name": "GET /documents/user/{user_id}/balance",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/pdf"
              }
            ],
            "url": "{{baseUrl}}/api/v1/documents/user/{{userId}}/balance?download=false",
            "description": "Возвращает application/pdf. Параметры query: download."
          }
        },
        {
          "name": "GET /documents/health",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/documents/health",
            "description": "Проверка доступности PDF сервиса."
          }
        }
      ]
    },
    {
      "name": "Matching",
      "description": "Матчинг заказов и водителей (подбор): регистрация водителя в трекере, лента доступных заказов, поиск водителей и принятие заказа (идемпотентно).",
      "item": [
        {
          "name": "POST /matching/driver/register",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driver_profile_id\": {{driverProfileId}},\n  \"user_id\": {{userId}},\n  \"classes_allowed\": [\"economy\"],\n  \"rating\": 5.0\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/matching/driver/register",
            "description": "Регистрирует водителя в трекере (в памяти) для матчинга. В роутере не задана явная зависимость авторизации."
          }
        },
        {
          "name": "GET /matching/feed/{driver_profile_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/matching/feed/{{driverProfileId}}?limit=20",
            "description": "Возвращает ленту заказов для водителя. Требуется регистрация водителя в трекере и установленная геопозиция (иначе 400)."
          }
        },
        {
          "name": "POST /matching/accept/{ride_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driver_profile_id\": {{driverProfileId}},\n  \"user_id\": {{userId}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/matching/accept/{{rideId}}",
            "description": "Идемпотентное принятие: статусы могут быть accepted/already_yours/already_taken/not_found/invalid_status."
          }
        },
        {
          "name": "POST /matching/find-drivers",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ride_id\": {{rideId}},\n  \"ride_class\": \"economy\",\n  \"pickup_lat\": 55.751244,\n  \"pickup_lng\": 37.618423,\n  \"dropoff_lat\": 55.760000,\n  \"dropoff_lng\": 37.620000,\n  \"search_radius_km\": 5.0\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/matching/find-drivers?limit=10",
            "description": "Возвращает наиболее подходящих водителей для запроса."
          }
        },
        {
          "name": "GET /matching/stats",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/matching/stats",
            "description": "Возвращает статистику matching engine."
          }
        }
      ]
    },
    {
      "name": "Chat (HTTP + WebSocket)",
      "description": "Чат внутри поездки: HTTP эндпоинты для истории/отправки/редактирования/удаления сообщений и WebSocket для обмена сообщениями в реальном времени.",
      "item": [
        {
          "name": "GET /chat/{ride_id}/history",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat/{{rideId}}/history?limit=50",
            "description": "История чата. Параметры query: limit (1..100), before_id (пагинация)."
          }
        },
        {
          "name": "POST /chat/{ride_id}/send",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"Hello\",\n  \"message_type\": \"text\",\n  \"receiver_id\": 2,\n  \"attachments\": null\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/chat/{{rideId}}/send?sender_id={{userId}}",
            "description": "Отправка сообщения (HTTP). Есть rate-limit; модерация может отклонить (400)."
          }
        },
        {
          "name": "DELETE /chat/{ride_id}/message/{message_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat/{{rideId}}/message/{{messageId}}?user_id={{userId}}",
            "description": "Мягкое удаление сообщения. 404 если не найдено или нет прав."
          }
        },
        {
          "name": "PUT /chat/{ride_id}/message/{message_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"Edited text\",\n  \"message_type\": \"text\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/chat/{{rideId}}/message/{{messageId}}?user_id={{userId}}",
            "description": "Редактирование сообщения. 404 если не найдено или нет прав."
          }
        },
        {
          "name": "GET /chat/stats",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/chat/stats",
            "description": "Статистика сервиса чата."
          }
        },
        {
          "name": "WebSocket: /chat/ws/{ride_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v1/chat/ws/{{rideId}}?user_id={{userId}}&token={{accessToken}}",
            "description": "Это WebSocket-эндпоинт (не HTTP).\nURL: ws://host/api/v1/chat/ws/{ride_id}?user_id=...&token=...\nТипы сообщений: ping, typing, message."
          }
        }
      ]
    },
    {
      "name": "WebSocket Service (HTTP helpers)",
      "description": "Вспомогательные HTTP эндпоинты вокруг WebSocket-инфраструктуры (статистика, уведомления, рассылки) + описание WS URL и форматов сообщений.",
      "item": [
        {
          "name": "GET /ws/stats",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/ws/stats",
            "description": "Статистика активных WebSocket подключений (в памяти)."
          }
        },
        {
          "name": "POST /ws/notify/{user_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Hello\",\n  \"text\": \"Notification text\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/ws/notify/{{userId}}",
            "description": "Отправляет персональное сообщение подключённому пользователю (404 если не подключён)."
          }
        },
        {
          "name": "POST /ws/broadcast",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Broadcast\",\n  \"text\": \"For everyone\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/ws/broadcast",
            "description": "Рассылка всем подключённым пользователям."
          }
        },
        {
          "name": "POST /ws/driver/{user_id}/location",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"latitude\": 55.751244,\n  \"longitude\": 37.618423,\n  \"heading\": 120,\n  \"speed\": 10,\n  \"accuracy_m\": 15\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/ws/driver/{{userId}}/location",
            "description": "Обновляет геопозицию водителя в трекере. 404 если водитель не зарегистрирован."
          }
        },
        {
          "name": "POST /ws/driver/{user_id}/status",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"online\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/ws/driver/{{userId}}/status",
            "description": "Обновляет статус водителя в трекере. Разрешено: online/offline/paused (регистр не важен)."
          }
        },
        {
          "name": "GET /ws/driver/{user_id}/state",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/ws/driver/{{userId}}/state",
            "description": "Возвращает состояние трекера для пользователя. 404 если не найден."
          }
        },
        {
          "name": "GET /ws/drivers/stats",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/ws/drivers/stats",
            "description": "Сводная статистика трекера водителей + количество WS подключений."
          }
        },
        {
          "name": "WebSocket: /ws/{user_id}",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/v1/ws/{{userId}}?token={{accessToken}}",
            "description": "Это WebSocket-эндпоинт (не HTTP).\nURL: ws://host/api/v1/ws/{user_id}?token=...\nТипы сообщений: ping, join_ride, leave_ride, chat_message, location_update, go_online, go_offline, pause."
          }
        }
      ]
    },
    {
      "name": "DriverRatings",
      "description": "Оценки водителей: создание и управление отзывами/оценками, а также получение средней оценки по водителю.",
      "item": [
        {
          "name": "GET /driver-ratings",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-ratings?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /driver-ratings",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driver_profile_id\": {{driverProfileId}},\n  \"ride_id\": {{rideId}},\n  \"rate\": 5,\n  \"comment\": \"Great\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-ratings",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён.\nСервер устанавливает client_id из JWT user_id."
          }
        },
        {
          "name": "GET /driver-ratings/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-ratings/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "PUT /driver-ratings/{id}",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rate\": 4,\n  \"comment\": \"Ok\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/driver-ratings/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён, а также проверка владельца: DriverRating.client_id == JWT user_id."
          }
        },
        {
          "name": "DELETE /driver-ratings/{id}",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-ratings/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён, а также проверка владельца: DriverRating.client_id == JWT user_id."
          }
        },
        {
          "name": "GET /driver-ratings/{driver_id}/avg",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/driver-ratings/{{driverProfileId}}/avg?count=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён.\nПараметр query: count (опционально)."
          }
        }
      ]
    },
    {
      "name": "RideStatusHistory",
      "description": "История изменений статусов поездок (аудит): хранение переходов статусов, кто/когда изменил и причина. Обычно используется для аналитики и разборов.",
      "item": [
        {
          "name": "GET /ride-status-history",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/ride-status-history?page=1&page_size=10",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "POST /ride-status-history (admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ride_id\": {{rideId}},\n  \"from_status\": \"requested\",\n  \"to_status\": \"accepted\",\n  \"changed_by\": {{userId}},\n  \"actor_role\": \"driver\",\n  \"reason\": \"Accepted\",\n  \"meta\": {}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{baseUrl}}/api/v1/ride-status-history",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        },
        {
          "name": "GET /ride-status-history/{id}",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/ride-status-history/1",
            "description": "Требуется роль: user/driver/admin, телефон подтверждён."
          }
        },
        {
          "name": "DELETE /ride-status-history/{id} (admin)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{baseUrl}}/api/v1/ride-status-history/1",
            "description": "Требуется роль: admin, телефон подтверждён."
          }
        }
      ]
    }
  ]
}
